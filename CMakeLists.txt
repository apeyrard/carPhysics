cmake_minimum_required (VERSION 2.8)

# Useful macros
include(${CMAKE_SOURCE_DIR}/cmake/macros.cmake)

# Requires an out of source build
MACRO_ENSURE_OUT_OF_SOURCE_BUILD("Requires an out of source build.")

project(neuroCar)


set (CMAKE_BUILD_TYPE debug)

set (NEUROCAR_VERSION_MAJOR 0)
set (NEUROCAR_VERSION_MINOR 1)
set (NEUROCAR_VERSION_PATCH 0)
set (NEUROCAR_VERSION ${NEUROCAR_VERSION_MAJOR}.${NEUROCAR_VERSION_MINOR}.${NEUROCAR_VERSION_PATCH})

set(NEUROCAR_BINARY_DIR ${CMAKE_SOURCE_DIR}/bin/${CMAKE_BUILD_TYPE})

# Flags
if (CMAKE_COMPILER_IS_GNUCXX)
    set(CMAKE_CXX_FLAGS "-g -O2 -Wall -Wno-sign-compare")
    add_definitions(-std=gnu++0x)
endif()


### Sources ###

# Include directories
set(NEUROCAR_INCLUDE_DIR ${CMAKE_SOURCE_DIR}/include)
include_directories(${NEUROCAR_INCLUDE_DIR})

# Sources
set (NEUROCAR_SOURCE_DIR ./src)
set (NEUROCAR_SOURCES
    ${NEUROCAR_SOURCE_DIR}/renderer.cpp
    ${NEUROCAR_SOURCE_DIR}/world.cpp
    ${NEUROCAR_SOURCE_DIR}/drawable.cpp
    ${NEUROCAR_SOURCE_DIR}/staticbox.cpp
    ${NEUROCAR_SOURCE_DIR}/car.cpp
    ${NEUROCAR_SOURCE_DIR}/tire.cpp
    ${NEUROCAR_SOURCE_DIR}/raycastcallback.cpp
)


### Extern libraries ###

set(EXTERN_INCLUDE_DIR ${CMAKE_SOURCE_DIR}/libs/headers)
set(EXTERN_STATIC_LIB_DIR ${CMAKE_SOURCE_DIR}/libs/static)
set(NEUROCAR_EXTERN_LIBRARIES "")

# Box2D
set(EXTERN_INCLUDE_DIR_BOX2D ${EXTERN_INCLUDE_DIR}/)
set(EXTERN_LIBRARIES_BOX2D ${EXTERN_STATIC_LIB_DIR}/Box2D/libBox2D.a)
set(NEUROCAR_EXTERN_LIBRARIES ${NEUROCAR_EXTERN_LIBRARIES} ${EXTERN_LIBRARIES_BOX2D})
include_directories(SYSTEM ${EXTERN_INCLUDE_DIR_BOX2D})

# SFML
set(EXTERN_INCLUDE_DIR_SFML ${EXTERN_INCLUDE_DIR}/)
set(EXTERN_LIBRARIES_SFML
    ${EXTERN_STATIC_LIB_DIR}/SFML/libsfml-window-s.a
    ${EXTERN_STATIC_LIB_DIR}/SFML/libsfml-graphics-s.a
    ${EXTERN_STATIC_LIB_DIR}/SFML/libsfml-system-s.a
)
set(NEUROCAR_EXTERN_LIBRARIES ${NEUROCAR_EXTERN_LIBRARIES} ${EXTERN_LIBRARIES_SFML})
include_directories(SYSTEM ${EXTERN_INCLUDE_DIR_SFML})

# xcb
set(EXTERN_INCLUDE_DIR_XCB ${EXTERN_INCLUDE_DIR}/)
file(GLOB EXTERN_LIBRARIES_XCB ${EXTERN_STATIC_LIB_DIR}/xcb/*.a)
set(NEUROCAR_EXTERN_LIBRARIES ${NEUROCAR_EXTERN_LIBRARIES} ${EXTERN_LIBRARIES_XCB})
include_directories(SYSTEM ${EXTERN_INCLUDE_DIR_XCB})

# Udev
set(EXTERN_INCLUDE_DIR_UDEV ${EXTERN_INCLUDE_DIR}/)
set(EXTERN_LIBRARIES_UDEV ${EXTERN_STATIC_LIB_DIR}/udev/libudev.a)
set(NEUROCAR_EXTERN_LIBRARIES ${NEUROCAR_EXTERN_LIBRARIES} ${EXTERN_LIBRARIES_UDEV})
include_directories(SYSTEM ${EXTERN_INCLUDE_DIR_UDEV})

# Lib jpeg
set(EXTERN_INCLUDE_DIR_JPEG ${EXTERN_INCLUDE_DIR}/)
set(EXTERN_LIBRARIES_JPEG ${EXTERN_STATIC_LIB_DIR}/jpeg/libjpeg.a)
set(NEUROCAR_EXTERN_LIBRARIES ${NEUROCAR_EXTERN_LIBRARIES} ${EXTERN_LIBRARIES_JPEG})
include_directories(SYSTEM ${EXTERN_INCLUDE_DIR_JPEG})

# X11
set(EXTERN_INCLUDE_DIR_X11 ${EXTERN_INCLUDE_DIR}/)
set(EXTERN_LIBRARIES_X11
    ${EXTERN_STATIC_LIB_DIR}/X11/libX11.a
    ${EXTERN_STATIC_LIB_DIR}/X11/libX11-xcb.a
)
set(NEUROCAR_EXTERN_LIBRARIES ${NEUROCAR_EXTERN_LIBRARIES} ${EXTERN_LIBRARIES_X11})
include_directories(SYSTEM ${EXTERN_INCLUDE_DIR_X11})

# OpenGL
set(EXTERN_LIBRARIES_OPENGL GL)
set(NEUROCAR_EXTERN_LIBRARIES ${NEUROCAR_EXTERN_LIBRARIES} ${EXTERN_LIBRARIES_OPENGL})

# pthread
set(NEUROCAR_EXTERN_LIBRARIES ${NEUROCAR_EXTERN_LIBRARIES} pthread)


### Static library ###
set(LIBRARY_OUTPUT_PATH ${NEUROCAR_BINARY_DIR})
set(NEUROCAR_STATIC_LIBRARY NeuroCarPhysics)
add_library(${NEUROCAR_STATIC_LIBRARY} STATIC ${NEUROCAR_SOURCES})
target_link_libraries(${NEUROCAR_STATIC_LIBRARY} ${NEUROCAR_EXTERN_LIBRARIES})


### Executable ###
set(EXECUTABLE_NAME neuroCar)
set(EXECUTABLE_OUTPUT_PATH ${NEUROCAR_BINARY_DIR})
add_executable(${EXECUTABLE_NAME} ${NEUROCAR_SOURCE_DIR}/main.cpp)
target_link_libraries(${EXECUTABLE_NAME} ${NEUROCAR_STATIC_LIBRARY})
